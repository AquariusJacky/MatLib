#!/bin/bash

# Default installation paths
PREFIX="/usr/local"
CUDA_PATH="/usr/local/cuda"

# Parse command line arguments
while [[ $# -gt 0 ]]; do
    case $1 in
        --prefix=*)
        PREFIX="${1#*=}"
        shift
        ;;
        --with-cuda=*)
        CUDA_PATH="${1#*=}"
        shift
        ;;
        --help)
        echo "Usage: ./configure [options]"
        echo "Options:"
        echo "  --prefix=PATH         Installation prefix (default: /usr/local)"
        echo "  --with-cuda=PATH      CUDA installation path (default: /usr/local/cuda)"
        echo "  --help                Display this help message"
        exit 0
        ;;
        *)
        echo "Unknown option: $1"
        echo "Use --help for usage information"
        exit 1
        ;;
    esac
done

# Create config.mk with the settings
cat > config.mk << EOF
# Generated by configure script - do not edit
INSTALL_PREFIX := ${PREFIX}
CUDA_PREFIX := ${CUDA_PATH}

# Installation paths
INSTALL_LIB_PATH := \$(INSTALL_PREFIX)/lib
INSTALL_INCLUDE_PATH := \$(INSTALL_PREFIX)/include/gpumatrix

# CUDA paths
CUDA_INCLUDE := -I\$(CUDA_PREFIX)/include
CUDA_LIBDIR := -L\$(CUDA_PREFIX)/lib64
EOF

echo "Configuration completed:"
echo "  Installation prefix: ${PREFIX}"
echo "  CUDA path: ${CUDA_PATH}"
echo ""
echo "Now you can run:"
echo "  make           # Build the library"
echo "  make install   # Install the library"